{
  "name": "My workflow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "send-messages",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -320,
        -32
      ],
      "id": "2137da74-9ba2-4cbd-8bf2-01746e730c18",
      "name": "Webhook",
      "webhookId": "058bb49a-096d-4717-ae4f-2b7252e3bd89"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 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"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"mistralai/mistral-7b-instruct:free\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"{{$json[\"body\"][\"content\"]}}\"\n    }\n  ]\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -96,
        -128
      ],
      "id": "9336a5de-5734-4f8b-b171-03dd70a58ec5",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={\n  \"reply\": \"aagaya last tak\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1008,
        -16
      ],
      "id": "76bf5da2-7cd8-4115-bc3a-091c7e2b7d7b",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://dcthotdhgvfbsxyyguyi.hasura.ap-south-1.nhost.run/v1/graphql",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-hasura-admin-secret",
              "value": "!HYzlT3I&M01EI56hORnB,z:H+mmV-i&"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"query\": \"query CheckChat($chat_id: uuid!) { chats_by_pk(id: $chat_id) { id } }\",\n  \"variables\": {\n     \"chat_id\": \"{{ $json.chat_Id.replace(/^\"|\"$/g, '').trim() }}\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        208,
        -128
      ],
      "id": "check-chat-node",
      "name": "Check Chat"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://dcthotdhgvfbsxyyguyi.hasura.ap-south-1.nhost.run/v1/graphql",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-hasura-admin-secret",
              "value": "!HYzlT3I&M01EI56hORnB,z:H+mmV-i&"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"query\": \"mutation InsertChat($chat_id: uuid!) { insert_chats_one(object: { id: $chat_id }) { id } }\",\n  \"variables\": {\n     \"chat_id\": \"{{ $json.chat_Id.replace(/^\"|\"$/g, '').trim() }}\"\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        432,
        -128
      ],
      "id": "insert-chat-node",
      "name": "Insert Chat"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0face64e-dfb2-4e64-9a24-d47d8ae48bbf",
              "name": "safeContent",
              "value": "={{ $json[\"choices\"][0][\"message\"][\"content\"].replace(/\"/g, '\\\"') }}",
              "type": "string"
            },
            {
              "id": "8814b254-100f-46d7-8a6b-02cbf88a3cd5",
              "name": "chat_Id",
              "value": "=\"{{ $json.body.chat_id}}\"",
              "type": "string"
            },
            {
              "id": "4e1dc6a1-1377-4479-bbd5-f3fad58400e1",
              "name": "user_Id",
              "value": "=\"{{ $json.body.user_id}}\"",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        432,
        0
      ],
      "id": "d8101d6e-497f-4d4e-a83c-9e7927ac305e",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        208,
        0
      ],
      "id": "fb0fdd2d-0559-443b-bc84-73a23a00e8fe",
      "name": "Merge"
    }
  ],
  "pinData": {},
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook": {
      "main": [
        []
      ]
    },
    "HTTP Request2": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8f5b46b7-e4e4-488b-89e8-9db7bc64ca3f",
  "meta": {
    "instanceId": "973d275fea9c0fde1515a850dcd5dd257f2741fd12a4cfcfeb927a4d928c4d12"
  },
  "id": "7S4w9VlXrlW0JxDd",
  "tags": []
}